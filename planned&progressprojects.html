<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planned & In-Progress Projects</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- HEADER -->
    <header>
        <div class="logo">
            <span class="icon">âš¡</span>
            DREWCREW
        </div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="planned&progressprojects.html" style="color:#4ea8ff !important">Projects</a></li>
            <li><a href="contact.html">Contact Us</a></li>
        </ul>
    </header>

    <!-- HERO -->
    <section class="hero-title">
        <h1>Planned & In-Progress Projects</h1>
        <p>A combined overview of current project data from JSON and XML sources.</p>
    </section>


    <!-- ================= TABLES ================= -->
    <section class="table-section two-column-tables" style="padding: 0 40px;">

        <div class="table-wrapper">
            <h2>Planned Projects (JSON)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Project Name</th>
                        <th>Status</th>
                        <th>Budget</th>
                        <th>Winning Bidder</th>
                        <th>Project HQ</th>
                    </tr>
                </thead>
                <tbody id="planned-table"></tbody>
            </table>
        </div>

        <div class="table-wrapper">
            <h2>In-Progress Projects (XML)</h2>
            <table id="inprogress-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Budget</th>
                        <th>Winning Bidder</th>
                        <th>Project HQ</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </section>


    <!-- ================= SQL SECTION ================= -->
    <section class="sql-section" style="padding:40px; max-width:900px; margin:0 auto;">
        <h2 style="text-align:center;">SQL Queries Used</h2>

        <h3>1. Projects Located in Ontario</h3>
<pre><code>
SELECT Projects.project_id,
       Projects.project_name,
       Projects.project_status,
       Projects.budget,
       Projects.winning_bidder,
       Contractors.company_name AS winning_bidder_name,
       Projects.project_hq
FROM Projects
JOIN Tenders     ON Projects.project_id = Tenders.project_id
JOIN Provinces   ON Tenders.province_id = Provinces.province_id
JOIN Contractors ON Tenders.contractor_id = Contractors.contractor_id
WHERE Provinces.province_name = 'Ontario';
</code></pre>

        <h3>2. All In-Progress Projects</h3>
<pre><code>
SELECT Projects.*,
       Contractors.company_name AS winning_bidder_name
FROM Projects
LEFT JOIN Tenders     ON Projects.project_id = Tenders.project_id
LEFT JOIN Contractors ON Tenders.contractor_id = Contractors.contractor_id
WHERE Projects.project_status = 'In-Progress';
</code></pre>

        <h3>3. Count of Projects Assigned to Each Contractor</h3>
<pre><code>
SELECT Contractors.company_name,
       COUNT(Projects.project_id) AS number_of_projects
FROM Contractors
LEFT JOIN Projects
       ON Contractors.contractor_id = Projects.winning_bidder
GROUP BY Contractors.contractor_id, Contractors.company_name;
</code></pre>

        <h3>4. Update the Status of a Project to Completed</h3>
<pre><code>
UPDATE Projects
SET project_status = 'Completed'
WHERE project_id = 123;
</code></pre>

        <h3>5. Total Budget of All Projects Grouped by Province</h3>
<pre><code>
SELECT Provinces.province_name,
       SUM(Projects.budget) AS total_budget
FROM Projects
INNER JOIN Tenders   ON Projects.project_id = Tenders.project_id
INNER JOIN Provinces ON Tenders.province_id = Provinces.province_id
GROUP BY Provinces.province_name;
</code></pre>
    </section>


    <!-- ================= JAVASCRIPT ================= -->
<script>

    /* Load contractor names */
    let contractorLookup = {};

    const loadContractors = fetch(
        'https://raw.githubusercontent.com/JaY-III/COMP1020/drewe4444-patch-1/data-contractors.json'
    )
    .then(res => res.json())
    .then(data => {
        data.forEach(c => {
            contractorLookup[c.contractor_id] = c.company_name;
        });
    });


    /* Load planned projects */
    loadContractors.then(() => {
        fetch('https://jay-iii.github.io/COMP1020/data-Planned.json')
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('planned-table');

                data.projects.forEach(project => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td>${project.project_name}</td>
                        <td>${project.project_status}</td>
                        <td>${project.budget}</td>
                        <td>${contractorLookup[project.winning_bidder] || project.winning_bidder}</td>
                        <td>${project.project_hq}</td>
                    `;

                    tableBody.appendChild(row);
                });
            });
    });


    /* Helper for XML parsing */
    const getXMLText = (parent, tag) => {
        const el = parent.getElementsByTagName(tag)[0];
        return el ? el.textContent : '';
    };


    /* Load in-progress projects */
    loadContractors.then(() => {
        fetch('https://jay-iii.github.io/COMP1020/data-In-Progress.xml')
            .then(res => res.text())
            .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
            .then(xml => {
                const tableBody = document.querySelector('#inprogress-table tbody');
                const projects = xml.getElementsByTagName('Project');

                Array.from(projects).forEach(project => {
                    const bidderId = getXMLText(project, 'winning_bidder');

                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td>${getXMLText(project, 'project_name')}</td>
                        <td>${getXMLText(project, 'project_status')}</td>
                        <td>${getXMLText(project, 'budget')}</td>
                        <td>${contractorLookup[bidderId] || bidderId}</td>
                        <td>${getXMLText(project, 'project_hq')}</td>
                    `;

                    tableBody.appendChild(row);
                });
            });
    });

</script>


</body>
</html>


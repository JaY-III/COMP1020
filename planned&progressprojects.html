<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planned & In-Progress Projects</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- HEADER -->
    <header>
        <div class="logo">âš¡ DREWCREW</div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="planned&progressprojects.html" style="color:#4ea8ff">Projects</a></li>
            <li><a href="contact.html">Contact Us</a></li>
        </ul>
    </header>

    <!-- PAGE TITLE -->
    <div class="hero-title">
        <h1>Planned & In-Progress Projects</h1>
        <p>Data loaded from JSON, XML, and contractor lookup.</p>
    </div>


    <!-- TABLE SECTION -->
    <section class="table-section">

        <div class="two-column-tables">

            <!-- PLANNED PROJECTS TABLE -->
            <div class="table-wrapper">
                <h2>Planned Projects (JSON)</h2>

                <table>
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Winning Bidder</th>
                            <th>Project HQ</th>
                        </tr>
                    </thead>
                    <tbody id="planned-table"></tbody>
                </table>
            </div>

            <!-- IN-PROGRESS PROJECTS TABLE -->
            <div class="table-wrapper">
                <h2>In-Progress Projects (XML)</h2>

                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Winning Bidder</th>
                            <th>Project HQ</th>
                        </tr>
                    </thead>
                    <tbody id="inprogress-table"></tbody>
                </table>
            </div>

        </div>
    </section>


    <!-- SQL QUERIES & SCREENSHOTS -->
    <section class="sql-section">
        <h2>SQL Queries Used</h2>

        <!-- QUERY 1 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>1. Projects Located in Ontario</h3>
<pre>
SELECT Projects.project_id,
       Projects.project_name,
       Projects.project_status,
       Projects.budget,
       Projects.winning_bidder,
       Contractors.company_name AS winning_bidder_name,
       Projects.project_hq
FROM Projects
JOIN Tenders ON Projects.project_id = Tenders.project_id
JOIN Provinces ON Tenders.province_id = Provinces.province_id
JOIN Contractors ON Tenders.contractor_id = Contractors.contractor_id
WHERE Provinces.province_name = 'Ontario';
</pre>
            </div>

            <div class="sql-image">
                <img src="https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/Projects_Located_in_Ontario.png" alt="">
            </div>
        </div>


        <!-- QUERY 2 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>2. All In-Progress Projects</h3>
<pre>
SELECT Projects.*,
       Contractors.company_name AS winning_bidder_name
FROM Projects
LEFT JOIN Tenders ON Projects.project_id = Tenders.project_id
LEFT JOIN Contractors ON Tenders.contractor_id = Contractors.contractor_id
WHERE Projects.project_status = 'In-Progress';
</pre>
            </div>

            <div class="sql-image">
                <img src="https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/All_In_Progress_Projects.png" alt="">
            </div>
        </div>


        <!-- QUERY 3 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>3. Count of Projects Assigned to Each Contractor</h3>
<pre>
SELECT Contractors.company_name AS company_name,
       COUNT(Projects.project_id) AS total_projects
FROM Contractors
LEFT JOIN Projects
ON Contractors.contractor_id = Projects.winning_bidder
GROUP BY Contractors.contractor_id, Contractors.company_name
ORDER BY total_projects DESC
LIMIT 15;
</pre>
            </div>

            <div class="sql-image">
                <img src="https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/Count_of_Projects_Assigned_to_Each_Contractor.png" alt="">
            </div>
        </div>


        <!-- QUERY 4 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>4. Update Project Status</h3>
<pre>
UPDATE Projects
SET project_status = 'Completed'
WHERE project_id = 123;
</pre>
            </div>

            <div class="sql-image">
                <img src="https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/updateA.png" alt="">
                <img src="https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/updateB.png" alt="" style="margin-top:10px;">
            </div>
        </div>


        <!-- QUERY 5 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>5. Total Budget of All Projects by Province</h3>
<pre>
SELECT Provinces.province_name,
       SUM(Projects.budget) AS total_budget
FROM Projects
JOIN Tenders ON Projects.project_id = Tenders.project_id
JOIN Provinces ON Tenders.province_id = Provinces.province_id
GROUP BY Provinces.province_name;
</pre>
            </div>

            <div class="sql-image">
                <img src="https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/Total_Budget.png" alt="">
            </div>
        </div>

    </section>


    <!-- BEGINNER-FRIENDLY JAVASCRIPT -->
    <script>

        /* Contractor name lookup dictionary */
        let contractorLookup = {};

        fetch("https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/data-contractors.json")
            .then(res => res.json())
            .then(data => {
                for (let i = 0; i < data.length; i++) {
                    contractorLookup[data[i].contractor_id] = data[i].company_name;
                }

                loadPlanned();
                loadInProgress();
            });


        /* Load JSON planned projects */
        function loadPlanned() {
            fetch("https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/data-Planned.json")
                .then(res => res.json())
                .then(data => {

                    // FIX: JSON stores data in "projects"
                    let projects = data.projects;
                    let table = document.getElementById("planned-table");

                    for (let i = 0; i < projects.length; i++) {
                        let p = projects[i];
                        let bidderName = contractorLookup[p.winning_bidder];

                        table.innerHTML += `
                            <tr>
                                <td>${p.project_name}</td>
                                <td>${p.project_status}</td>
                                <td>${p.budget}</td>
                                <td>${bidderName}</td>
                                <td>${p.project_hq}</td>
                            </tr>
                        `;
                    }
                });
        }


        /* Load XML in-progress projects */
        function loadInProgress() {
            fetch("https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/data-In-Progress.xml")
                .then(res => res.text())
                .then(str => (new DOMParser()).parseFromString(str, "text/xml"))
                .then(xml => {
                    let table = document.getElementById("inprogress-table");
                    let items = xml.getElementsByTagName("Project");

                    for (let i = 0; i < items.length; i++) {
                        let p = items[i];

                        let name = p.getElementsByTagName("project_name")[0].textContent;
                        let status = p.getElementsByTagName("project_status")[0].textContent;
                        let budget = p.getElementsByTagName("budget")[0].textContent;
                        let bidder = p.getElementsByTagName("winning_bidder")[0].textContent;
                        let hq = p.getElementsByTagName("project_hq")[0].textContent;

                        let bidderName = contractorLookup[bidder];

                        table.innerHTML += `
                            <tr>
                                <td>${name}</td>
                                <td>${status}</td>
                                <td>${budget}</td>
                                <td>${bidderName}</td>
                                <td>${hq}</td>
                            </tr>
                        `;
                    }
                });
        }

    </script>

</body>
</html>

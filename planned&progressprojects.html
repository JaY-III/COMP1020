<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planned & In-Progress Projects</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- HEADER -->
    <header>
        <div class="logo">DREWCREW</div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="planned&progressprojects.html" style="color:#4ea8ff">Projects</a></li>
            <li><a href="contact.html">Contact Us</a></li>
        </ul>
    </header>

    <!-- PAGE TITLE -->
    <section class="hero-title">
        <h1>Planned & In-Progress Projects</h1>
        <p>Data loaded from JSON, XML, and contractor lookup.</p>
    </section>


    <!-- TABLES SECTION -->
    <section class="table-section">

        <div class="two-column-tables">

            <!-- Planned Projects -->
            <div class="table-wrapper">
                <h2>Planned Projects (JSON)</h2>

                <table>
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Winning Bidder</th>
                            <th>Project HQ</th>
                        </tr>
                    </thead>
                    <tbody id="planned-table"></tbody>
                </table>
            </div>

            <!-- In-Progress Projects -->
            <div class="table-wrapper">
                <h2>In-Progress Projects (XML)</h2>

                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Winning Bidder</th>
                            <th>Project HQ</th>
                        </tr>
                    </thead>
                    <tbody id="inprogress-table"></tbody>
                </table>
            </div>

        </div>
    </section>


    <!-- SQL QUERIES & SCREENSHOTS -->
    <section class="sql-section">
        <h2>SQL Queries Used</h2>

        <!-- Query 1 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>1. Projects Located in Ontario</h3>
<pre>
SELECT Projects.project_id,
       Projects.project_name,
       Projects.project_status,
       Projects.budget,
       Projects.winning_bidder,
       Contractors.company_name AS winning_bidder_name,
       Projects.project_hq
FROM Projects
JOIN Tenders     ON Projects.project_id = Tenders.project_id
JOIN Provinces   ON Tenders.province_id = Provinces.province_id
JOIN Contractors ON Tenders.contractor_id = Contractors.contractor_id
WHERE Provinces.province_name = 'Ontario';
</pre>
            </div>

            <div class="sql-image">
                <img src="screenshots/query1.png" alt="Query 1 Result">
            </div>
        </div>

        <!-- Query 2 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>2. All In-Progress Projects</h3>
<pre>
SELECT Projects.*,
       Contractors.company_name AS winning_bidder_name
FROM Projects
LEFT JOIN Tenders     ON Projects.project_id = Tenders.project_id
LEFT JOIN Contractors ON Tenders.contractor_id = Contractors.contractor_id
WHERE Projects.project_status = 'In-Progress';
</pre>
            </div>

            <div class="sql-image">
                <img src="screenshots/query2.png" alt="Query 2 Result">
            </div>
        </div>

        <!-- Query 3 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>3. Projects Per Contractor</h3>
<pre>
SELECT Contractors.company_name AS company_name,
       COUNT(Projects.project_id) AS total_projects
FROM Contractors
LEFT JOIN Projects
       ON Contractors.contractor_id = Projects.winning_bidder
GROUP BY Contractors.contractor_id, Contractors.company_name
ORDER BY total_projects DESC
LIMIT 15;
</pre>
            </div>

            <div class="sql-image">
                <img src="screenshots/query3.png" alt="Query 3 Result">
            </div>
        </div>

        <!-- Query 4 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>4. Update Project Status</h3>
<pre>
UPDATE Projects
SET project_status = 'Completed'
WHERE project_id = 123;
</pre>
            </div>

            <div class="sql-image">
                <img src="screenshots/query4.png" alt="Query 4 Result">
            </div>
        </div>

        <!-- Query 5 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>5. Total Budget by Province</h3>
<pre>
SELECT Provinces.province_name,
       SUM(Projects.budget) AS total_budget
FROM Projects
JOIN Tenders   ON Projects.project_id = Tenders.project_id
JOIN Provinces ON Tenders.province_id = Provinces.province_id
GROUP BY Provinces.province_name;
</pre>
            </div>

            <div class="sql-image">
                <img src="screenshots/query5.png" alt="Query 5 Result">
            </div>
        </div>

    </section>


    <!-- JAVASCRIPT FOR DATA LOADING -->
    <script>

        /* Contractor lookup */
        let contractorLookup = {};

        fetch("https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/data-contractors.json")
            .then(res => res.json())
            .then(data => {
                data.forEach(c => {
                    contractorLookup[c.contractor_id] = c.company_name;
                });
                loadPlanned();
                loadXML();
            });


        /* Load planned (JSON) projects */
        function loadPlanned() {
            fetch("https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/data-Planned.json")
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById("planned-table");
                    data.forEach(p => {
                        let row = `
                            <tr>
                                <td>${p.project_name}</td>
                                <td>${p.project_status}</td>
                                <td>${p.budget}</td>
                                <td>${contractorLookup[p.winning_bidder] || p.winning_bidder}</td>
                                <td>${p.project_hq}</td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                });
        }


        /* Load in-progress (XML) projects */
        function loadXML() {
            fetch("https://raw.githubusercontent.com/JaY-III/COMP1020/refs/heads/main/data-In-Progress.xml")
                .then(res => res.text())
                .then(text => new DOMParser().parseFromString(text, "text/xml"))
                .then(xml => {
                    const tbody = document.getElementById("inprogress-table");
                    const projects = xml.getElementsByTagName("Project");

                    for (let p of projects) {
                        let bidder = p.getElementsByTagName("winning_bidder")[0].textContent;
                        let row = `
                            <tr>
                                <td>${p.getElementsByTagName("project_name")[0].textContent}</td>
                                <td>${p.getElementsByTagName("project_status")[0].textContent}</td>
                                <td>${p.getElementsByTagName("budget")[0].textContent}</td>
                                <td>${contractorLookup[bidder] || bidder}</td>
                                <td>${p.getElementsByTagName("project_hq")[0].textContent}</td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    }
                });
        }

    </script>

</body>
</html>

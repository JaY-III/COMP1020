<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planned & In-Progress Projects</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Navigation Header -->
    <header>
        <div class="logo">âš¡ DREWCREW</div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="planned&progressprojects.html" style="color:#4ea8ff">Projects</a></li>
            <li><a href="contact.html">Contact Us</a></li>
        </ul>
    </header>

    <!-- Page Title Banner -->
    <div class="page-banner">
        <h1>Planned & In-Progress Projects</h1>
        <p>Data loaded from JSON, XML, and contractor lookup.</p>
    </div>

    <!-- TABLE SECTION -->
    <section class="table-section">

        <div class="two-column-tables">

            <!-- Planned JSON Table -->
            <div class="table-wrapper">
                <h2>Planned Projects (JSON)</h2>

                <table>
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Winning Bidder</th>
                            <th>Project HQ</th>
                        </tr>
                    </thead>
                    <tbody id="planned-table"></tbody>
                </table>
            </div>

            <!-- In-Progress XML Table -->
            <div class="table-wrapper">
                <h2>In-Progress Projects (XML)</h2>

                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Winning Bidder</th>
                            <th>Project HQ</th>
                        </tr>
                    </thead>
                    <tbody id="inprogress-table"></tbody>
                </table>
            </div>

        </div>
    </section>

    <!-- SQL QUERIES -->
    <section class="sql-section">
        <h2>SQL Queries Used</h2>

        <!-- Query 1 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>1. Projects Located in Ontario</h3>
<pre>
SELECT Projects.project_id,
       Projects.project_name,
       Projects.project_status,
       Projects.budget,
       Projects.winning_bidder,
       Contractors.company_name AS winning_bidder_name,
       Projects.project_hq
FROM Projects
JOIN Tenders ON Projects.project_id = Tenders.project_id
JOIN Provinces ON Tenders.province_id = Provinces.province_id
JOIN Contractors ON Tenders.contractor_id = Contractors.contractor_id
WHERE Provinces.province_name = 'Ontario';
</pre>
            </div>

            <div class="sql-image">
                <a href="Projects_Located_in_Ontario.png">
                    <img src="Projects_Located_in_Ontario.png">
                </a>
            </div>
        </div>

        <!-- Query 2 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>2. All In-Progress Projects</h3>
<pre>
SELECT Projects.*,
       Contractors.company_name AS winning_bidder_name
FROM Projects
LEFT JOIN Tenders ON Projects.project_id = Tenders.project_id
LEFT JOIN Contractors ON Tenders.contractor_id = Contractors.contractor_id
WHERE Projects.project_status = 'In-Progress';
</pre>
            </div>

            <div class="sql-image">
                <a href="All_In_Progress_Projects.png">
                    <img src="All_In_Progress_Projects.png">
                </a>
            </div>
        </div>

        <!-- Query 3 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>3. Count of Projects Assigned to Each Contractor</h3>
<pre>
SELECT Contractors.company_name AS company_name,
       COUNT(Projects.project_id) AS total_projects
FROM Contractors
LEFT JOIN Projects
ON Contractors.contractor_id = Projects.winning_bidder
GROUP BY Contractors.contractor_id, Contractors.company_name
ORDER BY total_projects DESC
LIMIT 15;
</pre>
            </div>

            <div class="sql-image">
                <a href="Count_of_Projects_Assigned_to_Each_Contractor.png">
                    <img src="Count_of_Projects_Assigned_to_Each_Contractor.png">
                </a>
            </div>
        </div>

        <!-- Query 4 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>4. Update Project Status</h3>
<pre>
UPDATE Projects
SET project_status = 'Completed'
WHERE project_id = 123;
</pre>
            </div>

            <div class="sql-image">
                <a href="updateA.png"><img src="updateA.png"></a>
                <a href="updateB.png"><img src="updateB.png" style="margin-top:10px"></a>
            </div>
        </div>

        <!-- Query 5 -->
        <div class="sql-row">
            <div class="sql-block">
                <h3>5. Total Budget of All Projects by Province</h3>
<pre>
SELECT Provinces.province_name,
       SUM(Projects.budget) AS total_budget
FROM Projects
JOIN Tenders ON Projects.project_id = Tenders.project_id
JOIN Provinces ON Tenders.province_id = Provinces.province_id
GROUP BY Provinces.province_name;
</pre>
            </div>

            <div class="sql-image">
                <a href="Total_Budget.png">
                    <img src="Total_Budget.png">
                </a>
            </div>
        </div>

    </section>

    <!-- SIMPLE BEGINNER JAVASCRIPT -->
    <script>

        /* Contractor lookup table */
        var contractorLookup = {};

        /* Load contractor JSON */
        fetch("data-contractors.json")
            .then(response => response.json())
            .then(contractors => {

                for (var i = 0; i < contractors.length; i++) {
                    contractorLookup[contractors[i].contractor_id] = contractors[i].company_name;
                }

                loadPlannedProjects();
                loadInProgressProjects();

            });

        /* Load the planned JSON projects */
   function loadPlannedProjects() {

    fetch("data-Planned.json")
        .then(r => r.json())
        .then(data => {

            var list = data; // <--- FIXED
            var table = document.getElementById("planned-table");

            for (var i = 0; i < list.length; i++) {
                var p = list[i];
                var winner = contractorLookup[p.winning_bidder];

                table.innerHTML +=
                "<tr>" +
                "<td>" + p.project_name + "</td>" +
                "<td>" + p.project_status + "</td>" +
                "<td>" + p.budget + "</td>" +
                "<td>" + winner + "</td>" +
                "<td>" + p.project_hq + "</td>" +
                "</tr>";
            }
        });
}


        /* Load in-progress XML projects */
        function loadInProgressProjects() {

            fetch("data-In-Progress.xml")
                .then(r => r.text())
                .then(text => (new DOMParser()).parseFromString(text, "text/xml"))
                .then(xml => {

                    var rows = xml.getElementsByTagName("Project");
                    var table = document.getElementById("inprogress-table");

                    for (var i = 0; i < rows.length; i++) {
                        var p = rows[i];

                        var name = p.getElementsByTagName("project_name")[0].textContent;
                        var status = p.getElementsByTagName("project_status")[0].textContent;
                        var budget = p.getElementsByTagName("budget")[0].textContent;
                        var bidderID = p.getElementsByTagName("winning_bidder")[0].textContent;
                        var hq = p.getElementsByTagName("project_hq")[0].textContent;

                        var bidderName = contractorLookup[bidderID];

                        table.innerHTML +=
                        "<tr>" +
                        "<td>" + name + "</td>" +
                        "<td>" + status + "</td>" +
                        "<td>" + budget + "</td>" +
                        "<td>" + bidderName + "</td>" +
                        "<td>" + hq + "</td>" +
                        "</tr>";
                    }
                });
        }

    </script>

</body>
</html>
